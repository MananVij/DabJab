<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="google-signin-scope" content="profile email" />
    <meta
      name="google-signin-client_id"
      content="502354893360-nu79cqqsiepagrk4s52nb4cketoo54ac.apps.googleusercontent.com"
    />

    <link rel="icon" href="./public/4.png" type="image/png" sizes="16x16" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato&display=swap"
      rel="stylesheet"
    />

    <title>DabJab</title>
    <style>
      #loader {
        position: absolute;
        margin: auto;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        width: fit-content;
        height: fit-content;
      }
      #loader img {
        width: 40vh;
      }
      #content {
        display: none;
      }
      p {
        font-family: "Open Sans", sans-serif;
      }
      .navlink {
        font-family: "Lato", sans-serif;
      }
      .card {
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        background-color: #F1FAFD;
        border-radius: 12px;
        border: 1px solid rgba(209, 213, 219, 0.3);
        box-shadow: 0 7px 30px -10px rgb(150 170 180 / 50%)
      }
      body {
        background-color: #07a6c2;
      }
      .container-fluid {
        width: auto;
      }
    </style>
  </head>
  <body
    style="
      width: 100%;
      font-family: 'Poppins', sans-serif;
      background-color: #f1fafd;
    "
  >
    <div id="loader">
      <img src="./public/plaster-new.gif" alt="" />
    </div>

    <div id="content">
      <!-- NavBar -->
      <nav
        class="navbar navbar-expand-lg navbar-light"
        style="background-color: #f1fafd; padding: 3rem 10% 0"
      >
        <a class="navbar-brand" href="./index.html">
          <img
            src="./public/4.png"
            width="30"
            height="30"
            class="d-inline-block align-top"
            alt=""
          />
          DabJab
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse me-1"
          id="navbarNav"
          style="justify-content: end"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="./index.html"
                >Home <span class="sr-only">(current)</span></a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./alldata.html">Get Data</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./resgister-camp.html"
                >Register as Camp</a
              >
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="./notify.html"
                >Set a Reminder <span class="sr-only">(current)</span></a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="./info.html">FAQ's</a>
            </li>
          </ul>
        </div>
      </nav>

      <!--    Form    -->
      <div style="display: flex; flex-direction: row; justify-content: center">
        <div
          class="container-fluid card"
          style="
            align-items: center;
            flex-direction: column;
            padding-top: 5vh;
            padding-bottom: 4vh;
            margin: 10vh 3vh 4vh;
          "
        >
          <h4
            style="
              text-align: center;
              margin-bottom: 6vh;
              font-family: 'Poppins', sans-serif;
              font-weight: bolder;
              font-size: 250%;
            "
          >
            Get Notified for Free!
          </h4>
          <form>
            <div class="row container-fluid" style="margin: 0">
              <div class="form-group col-lg-4 col-md-4 col-sm-12">
                <label>Name</label>
                <input
                  required
                  type="text"
                  class="form-control"
                  id="name"
                  pattern="[a-zA-Z][a-zA-Z ]+"
                  placeholder="Jimmy Walter"
                />
              </div>
              <div class="form-group col-lg-4 col-md-4 col-sm-12">
                <label>Email address</label>
                <input
                  required
                  type="email"
                  class="form-control"
                  id="email"
                  aria-describedby="emailHelp"
                  placeholder="abc@example.com"
                />
              </div>
              <div class="form-group col-lg-4 col-md-4 col-sm-12">
                <label>Pincode</label>
                <input
                  required
                  type="text"
                  class="form-control"
                  id="pincode"
                  pattern="[0-9]{6}"
                  aria-describedby="emailHelp"
                  placeholder="Pincode"
                />
              </div>
            </div>
            <div
              class="col-lg-12"
              style="
                display: flex;
                flex-direction: row;
                justify-content: center;
                padding-top: 2vh;
              "
            >
              <button class="btn btn-primary btn-md" style="margin-right: 1vh">
                Notify Me!
              </button>
              <div
                style="text-align: center; margin-right: 1vh"
                class="g-signin2"
                data-onsuccess="onSignIn"
              ></div>
            </div>
          </form>
        </div>
      </div>

      <div>
        <h3 style="text-align: center; font-family: 'Poppins', sans-serif"></h3>
      </div>
    </div>
    <!--        Google OAuth Script-->
    <script src="https://apis.google.com/js/platform.js" async></script>
    <!--        Bootstrap Script -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>

    <!--    My Script   -->
    <script>
      window.onload = function () {
        document.querySelector("#loader").style.display = "none";
        document.querySelector("#content").style.display = "block";
      };

      // <!-- If Signedin WIth other email -->
      const givenName = document.querySelector("#name");
      const givenEmail = document.querySelector("#email");
      const givenPincode = document.querySelector("#pincode");
      const form = document.querySelector("form");
      form.addEventListener("submit", (e) => {
        loader.style.display = "block";
        content.style.display = "none";
        e.preventDefault();
        const name = givenName.value;
        const email = givenEmail.value;
        const pincode = givenPincode.value;
        fetch("https://dabjab-backend.herokuapp.com/subscribe", {
          // mode: "no-cors",
          method: "post",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },

          body: JSON.stringify({
            name: name,
            email: email,
            pincode: pincode,
          }),
        })
          .then((response) => {
            document.querySelector("h3").innerHTML = "Please Check Your Email!";
            loader.style.display = "none";
            content.style.display = "block";
          })
          .catch((e) => {
            document.querySelector("h3").innerHTML = "EMail already exists!";
            loader.style.display = "none";
            content.style.display = "block";
          });
      });

      // Google SignIn
      async function onSignIn(googleUser) {
        try {
          var profile = await googleUser.getBasicProfile();
          const givenPincode = document.querySelector("#pincode");
          const pincode = givenPincode.value;

          if(pincode == '') {
            return document.querySelector("h3").innerHTML = "Please Enter Pincode!"; 
          }
          if (!profile) {
            throw new Error("No Profile Found!");
          }

          fetch("https://dabjab-backend.herokuapp.com/subscribe", {
            method: "post",
            headers: {
              Accept: "application/json",
              "Content-Type": "application/json",
            },

            body: JSON.stringify({
              name: profile.getName(),
              email: profile.getEmail(),
              pincode: pincode
            }),
          }).then((response) => {
            document.querySelector("h3").innerHTML = "Please Check Your Email!";
            signOut();
          });
        } catch (e) {
          console.log(e);
        }
      }

      function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          console.log("User signed out.");
        });
      }
    </script>
  </body>
</html>
